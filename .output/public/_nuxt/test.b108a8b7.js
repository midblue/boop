import{a as R,i as Y,j as z,r as i,b as q,w as G,e as H,k as P,v as U,u as k,h as x,l as J,t as I,F as K,s as N,o as O,m as Q}from"./entry.a9bb4c6a.js";const Z=".";let S=0;const M="\x1B[0m",ee="\x1B[2m",$={gray:"\x1B[2m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",pink:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},B=(...c)=>{var v;const h=/log\.[jt]s[^\n]*\n([^\n\r]*\/([^/\n\r]+\/[^/\n\r]+\/[^/:\n\r]+))\.[^:\n\r]+:(\d+)/gi.exec(`${new Error().stack}`),u=((v=h==null?void 0:h[2])==null?void 0:v.replace(/(dist\/|src\/)/gi,""))||"";[...c];for(let r=0;r<c.length;r++){const y=c[r];if(y in $){if(!c[r+1])continue;typeof c[r+1]=="object"||(c[r+1]=$[y]+`${c[r+1]}`+M),c.splice(r,1)}}let m=M+ee+`[${new Date().toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit"})}]`+u;for(`[${new Date().toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit"})}]`+u,m.length>S&&(S=m.length);m.length<Math.min(45,Math.max(25,S));)m+=Z;m+=M,console.log(m,...c)},te={class:"pre"},se={class:"pre"},oe=R({__name:"test",setup(c){const{$global:h}=Y();z({script:[{src:"./p5.js",type:"text/javascript"},{src:"./p5.sound.js",type:"text/javascript"}]});const u=i(`When the last days come
We shall see visions
More vivid than sunsets
Brighter than stars
We will recognize each other
And see ourselves for the first time
The way we really are`),m=q(()=>N(u.value));function v(l,t,d){t||(t="test"),d||(d="t");const g=261.63,f={major:[1,1.12242,1.25991,1.33482,1.4983,1.68176,1.8877,2],pentatonic:[1,1.12242,1.25991,1.4983,1.68176,2],minor:[1,1.05946,1.18921,1.33482,1.4983,1.68176,1.8877,2]},p=h.chordType.value,s=g*f[p][t.charCodeAt(0)%f[p].length],e=[1,1.4983],o=e[d.charCodeAt(0)%e.length];let a=s*o,n=.5,w=.5;return l==="."?(n=.5,w=.25):l==="-"?(a*=.5,n=.5,w=2):l===" "?(n=0,w=.5):l==="/"?(n=0,w=1):l===`
`&&(n=0,w=2),{frequency:a,amplitude:n,duration:w*2}}const r=q(()=>{const l=[],t=u.value.split(`
`);for(let d of t){const g=d.split(" ");for(let f of g){for(let p of f){const s=N(p);for(let e=0;e<s.length;e++)l.push(v(s[e],f,p));l.push(v(" "))}l.push(v("/"))}l.push(v(`
`))}return l}),y=i(15),j=i([]),A=i([]),T=i(null),E=i(null),C=i(.01),V=i(.05),D=i(.2),F=i(.05),b=i(!1),_=i(0),W=i([...r.value]),X=h.bpm;G(r,(l,t)=>{B("notesOfMorseCodeString changed"),W.value=[...l]},{deep:!0});function L(){const l=window==null?void 0:window.p5;new l(t=>{t.setup=()=>{t.createCanvas(710,200);for(let s=0;s<y.value;s++){const e=new l.Envelope;A.value.push(e);const o=new l.Oscillator("sine");j.value.push(o),o.start(),o.amp(e.value||0)}T.value=new l.FFT,E.value=T.value.waveform()},t.draw=()=>{t.background(255);const s=T.value.waveform();t.beginShape(),t.strokeWeight(5);for(let e=0;e<s.length;e++){const o=t.map(e,0,s.length,0,t.width),a=t.map(s[e],-1,1,0,t.height);t.vertex(o,a)}t.endShape()};const d=async s=>new Promise(e=>{const o=s.duration*60/X.value;setTimeout(()=>{e()},o*1e3);const a=j.value[_.value],n=A.value[_.value];s.amplitude&&(a.freq(s.frequency),n.setRange(s.amplitude*h.volume.value,0),F.value=o*o,n.setADSR(C.value,V.value,D.value,F.value),n.play(a),_.value=(_.value+1)%y.value)}),g=async s=>{let e=s.shift();e&&(await d(e),g(s))},f=s=>{B(s.length,"notes in words");let e=[],o=[];for(let a=0;a<s.length;a++){const n=s[a];!(n!=null&&n.amplitude)&&((n==null?void 0:n.duration)||0)>=1?(e.push(o),o=[]):o.push(n)}return e.push(o),e=e.filter(a=>a.length),B(e.length,"words"),e},p=async s=>{let e=[];for(let o=0;o<s.length;o++){const a=[];let n=s[o];for(;!(!(n!=null&&n.amplitude)||!n);)a.push(n),n=s[++o];e.push(a)}e=e.filter(o=>o.length&&o[0].amplitude),B(e.length,"letters",e.map(o=>o.length));for(let o of e)await g(o)};t.mousePressed=async()=>{if(b.value){t.mouseX>0&&t.mouseX<t.width&&t.mouseY>0&&(C.value=t.map(t.mouseX,0,t.width,.001,.3),D.value=t.map(t.mouseY,0,t.height,.01,.8));return}b.value=!0;const s=async()=>{for(let e of f(W.value))await p(e)};for(await s();h.loop.value;)await s();b.value=!1}},"sketch")}return(l,t)=>(O(),H(K,null,[P(x("textarea",{"onUpdate:modelValue":t[0]||(t[0]=d=>J(u)?u.value=d:null)},null,512),[[U,k(u)]]),x("div",te,I(k(u)),1),x("div",se,I(k(m)),1),x("div",null,[x("button",{onClick:L},"Go")])],64))}});const le=Q(oe,[["__scopeId","data-v-d741ea77"]]);export{le as default};
